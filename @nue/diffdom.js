var q=function(H){var J=arguments,V=[];for(var W=1;W<arguments.length;W++)V[W-1]=J[W];if(typeof H==="undefined"||H===null)return!1;return V.some(function(Q){var X,Z;return typeof((Z=(X=H===null||H===void 0?void 0:H.ownerDocument)===null||X===void 0?void 0:X.defaultView)===null||Z===void 0?void 0:Z[Q])==="function"&&H instanceof H.ownerDocument.defaultView[Q]})},D=function(H,J,V){var W;if(H.nodeName==="#text")W=V.document.createTextNode(H.data);else if(H.nodeName==="#comment")W=V.document.createComment(H.data);else{if(J)W=V.document.createElementNS("http://www.w3.org/2000/svg",H.nodeName);else if(H.nodeName.toLowerCase()==="svg")W=V.document.createElementNS("http://www.w3.org/2000/svg","svg"),J=!0;else W=V.document.createElement(H.nodeName);if(H.attributes)Object.entries(H.attributes).forEach(function(Q){var X=Q[0],Z=Q[1];return W.setAttribute(X,Z)});if(H.childNodes)W=W,H.childNodes.forEach(function(Q){return W.appendChild(D(Q,J,V))});if(V.valueDiffing){if(H.value&&q(W,"HTMLButtonElement","HTMLDataElement","HTMLInputElement","HTMLLIElement","HTMLMeterElement","HTMLOptionElement","HTMLProgressElement","HTMLParamElement"))W.value=H.value;if(H.checked&&q(W,"HTMLInputElement"))W.checked=H.checked;if(H.selected&&q(W,"HTMLOptionElement"))W.selected=H.selected}}return W},C=function(H,J,V){var W=J[V._const.action],Q=J[V._const.route],X;if(![V._const.addElement,V._const.addTextElement].includes(W))X=I(H,Q);var Z,z,P,K={diff:J,node:X};if(V.preDiffApply(K))return!0;switch(W){case V._const.addAttribute:if(!X||!q(X,"Element"))return!1;X.setAttribute(J[V._const.name],J[V._const.value]);break;case V._const.modifyAttribute:if(!X||!q(X,"Element"))return!1;if(X.setAttribute(J[V._const.name],J[V._const.newValue]),q(X,"HTMLInputElement")&&J[V._const.name]==="value")X.value=J[V._const.newValue];break;case V._const.removeAttribute:if(!X||!q(X,"Element"))return!1;X.removeAttribute(J[V._const.name]);break;case V._const.modifyTextElement:if(!X||!q(X,"Text"))return!1;if(V.textDiff(X,X.data,J[V._const.oldValue],J[V._const.newValue]),q(X.parentNode,"HTMLTextAreaElement"))X.parentNode.value=J[V._const.newValue];break;case V._const.modifyValue:if(!X||typeof X.value==="undefined")return!1;X.value=J[V._const.newValue];break;case V._const.modifyComment:if(!X||!q(X,"Comment"))return!1;V.textDiff(X,X.data,J[V._const.oldValue],J[V._const.newValue]);break;case V._const.modifyChecked:if(!X||typeof X.checked==="undefined")return!1;X.checked=J[V._const.newValue];break;case V._const.modifySelected:if(!X||typeof X.selected==="undefined")return!1;X.selected=J[V._const.newValue];break;case V._const.replaceElement:{var $=J[V._const.newValue].nodeName.toLowerCase()==="svg"||X.parentNode.namespaceURI==="http://www.w3.org/2000/svg";X.parentNode.replaceChild(D(J[V._const.newValue],$,V),X);break}case V._const.relocateGroup:P=Array.apply(void 0,new Array(J[V._const.groupLength])).map(function(){return X.removeChild(X.childNodes[J[V._const.from]])}),P.forEach(function(U,Y){if(Y===0)z=X.childNodes[J[V._const.to]];X.insertBefore(U,z||null)});break;case V._const.removeElement:X.parentNode.removeChild(X);break;case V._const.addElement:{var G=Q.slice(),M=G.splice(G.length-1,1)[0];if(X=I(H,G),!q(X,"Element"))return!1;X.insertBefore(D(J[V._const.element],X.namespaceURI==="http://www.w3.org/2000/svg",V),X.childNodes[M]||null);break}case V._const.removeTextElement:{if(!X||X.nodeType!==3)return!1;var B=X.parentNode;if(B.removeChild(X),q(B,"HTMLTextAreaElement"))B.value="";break}case V._const.addTextElement:{var G=Q.slice(),M=G.splice(G.length-1,1)[0];if(Z=V.document.createTextNode(J[V._const.value]),X=I(H,G),!X.childNodes)return!1;if(X.insertBefore(Z,X.childNodes[M]||null),q(X.parentNode,"HTMLTextAreaElement"))X.parentNode.value=J[V._const.value];break}default:console.log("unknown action")}return V.postDiffApply({diff:K.diff,node:K.node,newNode:Z}),!0},m=function(H,J,V){return J.every(function(W){return C(H,W,V)})},L=function(H,J,V){var W=H[J];H[J]=H[V],H[V]=W},a=function(H,J,V){switch(J[V._const.action]){case V._const.addAttribute:J[V._const.action]=V._const.removeAttribute,C(H,J,V);break;case V._const.modifyAttribute:L(J,V._const.oldValue,V._const.newValue),C(H,J,V);break;case V._const.removeAttribute:J[V._const.action]=V._const.addAttribute,C(H,J,V);break;case V._const.modifyTextElement:L(J,V._const.oldValue,V._const.newValue),C(H,J,V);break;case V._const.modifyValue:L(J,V._const.oldValue,V._const.newValue),C(H,J,V);break;case V._const.modifyComment:L(J,V._const.oldValue,V._const.newValue),C(H,J,V);break;case V._const.modifyChecked:L(J,V._const.oldValue,V._const.newValue),C(H,J,V);break;case V._const.modifySelected:L(J,V._const.oldValue,V._const.newValue),C(H,J,V);break;case V._const.replaceElement:L(J,V._const.oldValue,V._const.newValue),C(H,J,V);break;case V._const.relocateGroup:L(J,V._const.from,V._const.to),C(H,J,V);break;case V._const.removeElement:J[V._const.action]=V._const.addElement,C(H,J,V);break;case V._const.addElement:J[V._const.action]=V._const.removeElement,C(H,J,V);break;case V._const.removeTextElement:J[V._const.action]=V._const.addTextElement,C(H,J,V);break;case V._const.addTextElement:J[V._const.action]=V._const.removeTextElement,C(H,J,V);break;default:console.log("unknown action")}},r=function(H,J,V){J=J.slice(),J.reverse(),J.forEach(function(W){a(H,W,V)})},j=function(H,J){var V=H,W,Q;J=J.slice();while(J.length>0)Q=J.splice(0,1)[0],W=V,V=V.childNodes?V.childNodes[Q]:void 0;return{node:V,parentNode:W,nodeIndex:Q}},i=function(H,J,V){var W,Q,X,Z;if(![V._const.addElement,V._const.addTextElement].includes(J[V._const.action])){var z=j(H,J[V._const.route]);Q=z.node,X=z.parentNode,Z=z.nodeIndex}var P=[],K={diff:J,node:Q};if(V.preVirtualDiffApply(K))return!0;var $,G,M;switch(J[V._const.action]){case V._const.addAttribute:if(!Q.attributes)Q.attributes={};if(Q.attributes[J[V._const.name]]=J[V._const.value],J[V._const.name]==="checked")Q.checked=!0;else if(J[V._const.name]==="selected")Q.selected=!0;else if(Q.nodeName==="INPUT"&&J[V._const.name]==="value")Q.value=J[V._const.value];break;case V._const.modifyAttribute:Q.attributes[J[V._const.name]]=J[V._const.newValue];break;case V._const.removeAttribute:if(delete Q.attributes[J[V._const.name]],Object.keys(Q.attributes).length===0)delete Q.attributes;if(J[V._const.name]==="checked")Q.checked=!1;else if(J[V._const.name]==="selected")delete Q.selected;else if(Q.nodeName==="INPUT"&&J[V._const.name]==="value")delete Q.value;break;case V._const.modifyTextElement:if(Q.data=J[V._const.newValue],X.nodeName==="TEXTAREA")X.value=J[V._const.newValue];break;case V._const.modifyValue:Q.value=J[V._const.newValue];break;case V._const.modifyComment:Q.data=J[V._const.newValue];break;case V._const.modifyChecked:Q.checked=J[V._const.newValue];break;case V._const.modifySelected:Q.selected=J[V._const.newValue];break;case V._const.replaceElement:$=w(J[V._const.newValue]),X.childNodes[Z]=$;break;case V._const.relocateGroup:if(G=Q.childNodes.splice(J[V._const.from],J[V._const.groupLength]).reverse(),G.forEach(function(Y){return Q.childNodes.splice(J[V._const.to],0,Y)}),Q.subsets)Q.subsets.forEach(function(Y){if(J[V._const.from]<J[V._const.to]&&Y.oldValue<=J[V._const.to]&&Y.oldValue>J[V._const.from]){Y.oldValue-=J[V._const.groupLength];var F=Y.oldValue+Y.length-J[V._const.to];if(F>0)P.push({oldValue:J[V._const.to]+J[V._const.groupLength],newValue:Y.newValue+Y.length-F,length:F}),Y.length-=F}else if(J[V._const.from]>J[V._const.to]&&Y.oldValue>J[V._const.to]&&Y.oldValue<J[V._const.from]){Y.oldValue+=J[V._const.groupLength];var F=Y.oldValue+Y.length-J[V._const.to];if(F>0)P.push({oldValue:J[V._const.to]+J[V._const.groupLength],newValue:Y.newValue+Y.length-F,length:F}),Y.length-=F}else if(Y.oldValue===J[V._const.from])Y.oldValue=J[V._const.to]});break;case V._const.removeElement:if(X.childNodes.splice(Z,1),X.subsets)X.subsets.forEach(function(Y){if(Y.oldValue>Z)Y.oldValue-=1;else if(Y.oldValue===Z)Y.delete=!0;else if(Y.oldValue<Z&&Y.oldValue+Y.length>Z)if(Y.oldValue+Y.length-1===Z)Y.length--;else P.push({newValue:Y.newValue+Z-Y.oldValue,oldValue:Z,length:Y.length-Z+Y.oldValue-1}),Y.length=Z-Y.oldValue});Q=X;break;case V._const.addElement:{M=J[V._const.route].slice();var B=M.splice(M.length-1,1)[0];if(Q=(W=j(H,M))===null||W===void 0?void 0:W.node,$=w(J[V._const.element]),!Q.childNodes)Q.childNodes=[];if(B>=Q.childNodes.length)Q.childNodes.push($);else Q.childNodes.splice(B,0,$);if(Q.subsets)Q.subsets.forEach(function(Y){if(Y.oldValue>=B)Y.oldValue+=1;else if(Y.oldValue<B&&Y.oldValue+Y.length>B){var F=Y.oldValue+Y.length-B;P.push({newValue:Y.newValue+Y.length-F,oldValue:B+1,length:F}),Y.length-=F}});break}case V._const.removeTextElement:if(X.childNodes.splice(Z,1),X.nodeName==="TEXTAREA")delete X.value;if(X.subsets)X.subsets.forEach(function(Y){if(Y.oldValue>Z)Y.oldValue-=1;else if(Y.oldValue===Z)Y.delete=!0;else if(Y.oldValue<Z&&Y.oldValue+Y.length>Z)if(Y.oldValue+Y.length-1===Z)Y.length--;else P.push({newValue:Y.newValue+Z-Y.oldValue,oldValue:Z,length:Y.length-Z+Y.oldValue-1}),Y.length=Z-Y.oldValue});Q=X;break;case V._const.addTextElement:{M=J[V._const.route].slice();var U=M.splice(M.length-1,1)[0];if($={nodeName:"#text",data:J[V._const.value]},Q=j(H,M).node,!Q.childNodes)Q.childNodes=[];if(U>=Q.childNodes.length)Q.childNodes.push($);else Q.childNodes.splice(U,0,$);if(Q.nodeName==="TEXTAREA")Q.value=J[V._const.newValue];if(Q.subsets)Q.subsets.forEach(function(Y){if(Y.oldValue>=U)Y.oldValue+=1;if(Y.oldValue<U&&Y.oldValue+Y.length>U){var F=Y.oldValue+Y.length-U;P.push({newValue:Y.newValue+Y.length-F,oldValue:U+1,length:F}),Y.length-=F}});break}default:console.log("unknown action")}if(Q.subsets){if(Q.subsets=Q.subsets.filter(function(Y){return!Y.delete&&Y.oldValue!==Y.newValue}),P.length)Q.subsets=Q.subsets.concat(P)}V.postVirtualDiffApply({node:K.node,diff:K.diff,newNode:$});return},t=function(H,J,V){return J.forEach(function(W){i(H,W,V)}),!0},v=function(H,J){if(J===void 0)J={valueDiffing:!0};var V={nodeName:H.nodeName};if(q(H,"Text","Comment"))V.data=H.data;else{if(H.attributes&&H.attributes.length>0){V.attributes={};var W=Array.prototype.slice.call(H.attributes);W.forEach(function(Q){return V.attributes[Q.name]=Q.value})}if(H.childNodes&&H.childNodes.length>0){V.childNodes=[];var W=Array.prototype.slice.call(H.childNodes);W.forEach(function(X){return V.childNodes.push(v(X,J))})}if(J.valueDiffing){if(q(H,"HTMLTextAreaElement"))V.value=H.value;if(q(H,"HTMLInputElement")&&["radio","checkbox"].includes(H.type.toLowerCase())&&H.checked!==void 0)V.checked=H.checked;else if(q(H,"HTMLButtonElement","HTMLDataElement","HTMLInputElement","HTMLLIElement","HTMLMeterElement","HTMLOptionElement","HTMLProgressElement","HTMLParamElement"))V.value=H.value;if(q(H,"HTMLOptionElement"))V.selected=H.selected}}return V},N=function(H){return H.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},A=function(){function H(J){var V=this;if(J===void 0)J={};Object.entries(J).forEach(function(W){var Q=W[0],X=W[1];return V[Q]=X})}return H.prototype.toString=function(){return JSON.stringify(this)},H.prototype.setValue=function(J,V){return this[J]=V,this},H}(),I=function(H,J){J=J.slice();while(J.length>0){var V=J.splice(0,1)[0];H=H.childNodes[V]}return H},_=function(){return _=Object.assign||function H(J){var V=arguments;for(var W,Q=1,X=arguments.length;Q<X;Q++){W=V[Q];for(var Z in W)if(Object.prototype.hasOwnProperty.call(W,Z))J[Z]=W[Z]}return J},_.apply(this,arguments)};var h=function(H){var J=[];if(J.push(H.nodeName),H.nodeName!=="#text"&&H.nodeName!=="#comment"){if(H=H,H.attributes){if(H.attributes.class)J.push("".concat(H.nodeName,".").concat(H.attributes.class.replace(/ /g,".")));if(H.attributes.id)J.push("".concat(H.nodeName,"#").concat(H.attributes.id))}}return J},x=function(H){var J={},V={};return H.forEach(function(W){h(W).forEach(function(Q){var X=Q in J,Z=Q in V;if(!X&&!Z)J[Q]=!0;else if(X)delete J[Q],V[Q]=!0})}),J},u=function(H,J){var V=x(H),W=x(J),Q={};return Object.keys(V).forEach(function(X){if(W[X])Q[X]=!0}),Q},l=function(H){if(delete H.outerDone,delete H.innerDone,delete H.valueDone,H.childNodes)return H.childNodes.every(l);else return!0},w=function(H){if(Object.prototype.hasOwnProperty.call(H,"data")){var J={nodeName:H.nodeName==="#text"?"#text":"#comment",data:H.data};return J}else{var V={nodeName:H.nodeName};if(H=H,Object.prototype.hasOwnProperty.call(H,"attributes"))V.attributes=_({},H.attributes);if(Object.prototype.hasOwnProperty.call(H,"checked"))V.checked=H.checked;if(Object.prototype.hasOwnProperty.call(H,"value"))V.value=H.value;if(Object.prototype.hasOwnProperty.call(H,"selected"))V.selected=H.selected;if(Object.prototype.hasOwnProperty.call(H,"childNodes"))V.childNodes=H.childNodes.map(function(W){return w(W)});return V}},b=function(H,J){if(!["nodeName","value","checked","selected","data"].every(function(Q){if(H[Q]!==J[Q])return!1;return!0}))return!1;if(Object.prototype.hasOwnProperty.call(H,"data"))return!0;if(H=H,J=J,Boolean(H.attributes)!==Boolean(J.attributes))return!1;if(Boolean(H.childNodes)!==Boolean(J.childNodes))return!1;if(H.attributes){var V=Object.keys(H.attributes),W=Object.keys(J.attributes);if(V.length!==W.length)return!1;if(!V.every(function(Q){if(H.attributes[Q]!==J.attributes[Q])return!1;return!0}))return!1}if(H.childNodes){if(H.childNodes.length!==J.childNodes.length)return!1;if(!H.childNodes.every(function(Q,X){return b(Q,J.childNodes[X])}))return!1}return!0},g=function(H,J,V,W,Q){if(Q===void 0)Q=!1;if(!H||!J)return!1;if(H.nodeName!==J.nodeName)return!1;if(["#text","#comment"].includes(H.nodeName))return Q?!0:H.data===J.data;if(H=H,J=J,H.nodeName in V)return!0;if(H.attributes&&J.attributes){if(H.attributes.id)if(H.attributes.id!==J.attributes.id)return!1;else{var X="".concat(H.nodeName,"#").concat(H.attributes.id);if(X in V)return!0}if(H.attributes.class&&H.attributes.class===J.attributes.class){var Z="".concat(H.nodeName,".").concat(H.attributes.class.replace(/ /g,"."));if(Z in V)return!0}}if(W)return!0;var z=H.childNodes?H.childNodes.slice().reverse():[],P=J.childNodes?J.childNodes.slice().reverse():[];if(z.length!==P.length)return!1;if(Q)return z.every(function($,G){return $.nodeName===P[G].nodeName});else{var K=u(z,P);return z.every(function($,G){return g($,P[G],K,!0,!0)})}},f=function(H,J,V,W){var Q=0,X=[],Z=H.length,z=J.length,P=Array.apply(void 0,new Array(Z+1)).map(function(){return[]}),K=u(H,J),$=Z===z;if($)H.some(function(Y,F){var E=h(Y),R=h(J[F]);if(E.length!==R.length)return $=!1,!0;if(E.some(function(O,S){if(O!==R[S])return $=!1,!0}),!$)return!0});for(var G=0;G<Z;G++){var M=H[G];for(var B=0;B<z;B++){var U=J[B];if(!V[G]&&!W[B]&&g(M,U,K,$)){if(P[G+1][B+1]=P[G][B]?P[G][B]+1:1,P[G+1][B+1]>=Q)Q=P[G+1][B+1],X=[G+1,B+1]}else P[G+1][B+1]=0}}if(Q===0)return!1;return{oldValue:X[0]-Q,newValue:X[1]-Q,length:Q}},y=function(H,J){return Array.apply(void 0,new Array(H)).map(function(){return J})},p=function(H,J,V){var W=H.childNodes?y(H.childNodes.length,!0):[],Q=J.childNodes?y(J.childNodes.length,!0):[],X=0;return V.forEach(function(Z){var z=Z.oldValue+Z.length,P=Z.newValue+Z.length;for(var K=Z.oldValue;K<z;K+=1)W[K]=X;for(var K=Z.newValue;K<P;K+=1)Q[K]=X;X+=1}),{gaps1:W,gaps2:Q}},s=function(H,J,V,W){H[V.oldValue+W]=!0,J[V.newValue+W]=!0},d=function(H,J){var V=H.childNodes?H.childNodes:[],W=J.childNodes?J.childNodes:[],Q=y(V.length,!1),X=y(W.length,!1),Z=[],z=function(){return arguments[1]},P=!1,K=function(){var $=f(V,W,Q,X);if($){Z.push($);var G=Array.apply(void 0,new Array($.length)).map(z);G.forEach(function(M){return s(Q,X,$,M)})}else P=!0};while(!P)K();return H.subsets=Z,H.subsetsAge=100,Z},n=function(){function H(){this.list=[]}return H.prototype.add=function(J){var V;(V=this.list).push.apply(V,J)},H.prototype.forEach=function(J){this.list.forEach(function(V){return J(V)})},H}(),o=/<\s*\/*[a-zA-Z:_][a-zA-Z0-9:_\-.]*\s*(?:"[^"]*"['"]*|'[^']*'['"]*|[^'"/>])*\/*\s*>|<!--(?:.|\n|\r)*?-->/g,e=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g,V1={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuItem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},c=function(H,J){var V={nodeName:"",attributes:{}},W=!1,Q="tag",X=H.match(/<\/?([^\s]+?)[/\s>]/);if(X){if(V.nodeName=J||X[1]==="svg"?X[1]:X[1].toUpperCase(),V1[X[1]]||H.charAt(H.length-2)==="/")W=!0;if(V.nodeName.startsWith("!--")){var Z=H.indexOf("-->");return{type:"comment",node:{nodeName:"#comment",data:Z!==-1?H.slice(4,Z):""},voidElement:W}}}var z=new RegExp(e),P=null,K=!1;while(!K)if(P=z.exec(H),P===null)K=!0;else if(P[0].trim()){if(P[1]){var $=P[1].trim(),G=[$,""];if($.indexOf("=")>-1)G=$.split("=");V.attributes[G[0]]=G[1],z.lastIndex--}else if(P[2])V.attributes[P[2]]=P[3].trim().substring(1,P[3].length-1)}return{type:Q,node:V,voidElement:W}},T=function(H,J){if(J===void 0)J={valueDiffing:!0,caseSensitive:!1};var V=[],W,Q=-1,X=[],Z=!1,z=!1;if(H.indexOf("<")!==0){var P=H.indexOf("<");V.push({nodeName:"#text",data:P===-1?H:H.substring(0,P)})}return H.replace(o,function(K,$){var G=K.charAt(1)!=="/",M=K.startsWith("<!--"),B=$+K.length,U=H.charAt(B);if(M){var Y=c(K,J.caseSensitive).node;if(Q<0)return V.push(Y),"";var F=X[Q];if(F&&Y.nodeName){if(!F.node.childNodes)F.node.childNodes=[];F.node.childNodes.push(Y)}return""}if(G){if(W=c(K,J.caseSensitive||z),W.node.nodeName==="svg")z=!0;if(Q++,!W.voidElement&&!Z&&U&&U!=="<"){if(!W.node.childNodes)W.node.childNodes=[];var E=N(H.slice(B,H.indexOf("<",B)));if(W.node.childNodes.push({nodeName:"#text",data:E}),J.valueDiffing&&W.node.nodeName==="TEXTAREA")W.node.value=E}if(Q===0&&W.node.nodeName)V.push(W.node);var R=X[Q-1];if(R&&W.node.nodeName){if(!R.node.childNodes)R.node.childNodes=[];R.node.childNodes.push(W.node)}X[Q]=W}if(!G||W.voidElement){if(Q>-1&&(W.voidElement||J.caseSensitive&&W.node.nodeName===K.slice(2,-1)||!J.caseSensitive&&W.node.nodeName.toUpperCase()===K.slice(2,-1).toUpperCase())){if(Q--,Q>-1){if(W.node.nodeName==="svg")z=!1;W=X[Q]}}if(U!=="<"&&U){var O=Q===-1?V:X[Q].node.childNodes||[],S=H.indexOf("<",B),E=N(H.slice(B,S===-1?void 0:S));O.push({nodeName:"#text",data:E})}}return""}),V[0]},J1=function(){function H(J,V,W){if(this.options=W,this.t1=typeof Element!=="undefined"&&q(J,"Element")?v(J,this.options):typeof J==="string"?T(J,this.options):JSON.parse(JSON.stringify(J)),this.t2=typeof Element!=="undefined"&&q(V,"Element")?v(V,this.options):typeof V==="string"?T(V,this.options):JSON.parse(JSON.stringify(V)),this.diffcount=0,this.foundAll=!1,this.debug)this.t1Orig=typeof Element!=="undefined"&&q(J,"Element")?v(J,this.options):typeof J==="string"?T(J,this.options):JSON.parse(JSON.stringify(J)),this.t2Orig=typeof Element!=="undefined"&&q(V,"Element")?v(V,this.options):typeof V==="string"?T(V,this.options):JSON.parse(JSON.stringify(V));this.tracker=new n}return H.prototype.init=function(){return this.findDiffs(this.t1,this.t2)},H.prototype.findDiffs=function(J,V){var W;do{if(this.options.debug){if(this.diffcount+=1,this.diffcount>this.options.diffcap)throw new Error("surpassed diffcap:".concat(JSON.stringify(this.t1Orig)," -> ").concat(JSON.stringify(this.t2Orig)))}if(W=this.findNextDiff(J,V,[]),W.length===0){if(!b(J,V))if(this.foundAll)console.error("Could not find remaining diffs!");else this.foundAll=!0,l(J),W=this.findNextDiff(J,V,[])}if(W.length>0)this.foundAll=!1,this.tracker.add(W),t(J,W,this.options)}while(W.length>0);return this.tracker.list},H.prototype.findNextDiff=function(J,V,W){var Q,X;if(this.options.maxDepth&&W.length>this.options.maxDepth)return[];if(!J.outerDone){if(Q=this.findOuterDiff(J,V,W),this.options.filterOuterDiff){if(X=this.options.filterOuterDiff(J,V,Q),X)Q=X}if(Q.length>0)return J.outerDone=!0,Q;else J.outerDone=!0}if(Object.prototype.hasOwnProperty.call(J,"data"))return[];if(J=J,V=V,!J.innerDone)if(Q=this.findInnerDiff(J,V,W),Q.length>0)return Q;else J.innerDone=!0;if(this.options.valueDiffing&&!J.valueDone)if(Q=this.findValueDiff(J,V,W),Q.length>0)return J.valueDone=!0,Q;else J.valueDone=!0;return[]},H.prototype.findOuterDiff=function(J,V,W){var Q=[],X,Z,z,P,K,$;if(J.nodeName!==V.nodeName){if(!W.length)throw new Error("Top level nodes have to be of the same kind.");return[new A().setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,w(J)).setValue(this.options._const.newValue,w(V)).setValue(this.options._const.route,W)]}if(W.length&&this.options.diffcap<Math.abs((J.childNodes||[]).length-(V.childNodes||[]).length))return[new A().setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,w(J)).setValue(this.options._const.newValue,w(V)).setValue(this.options._const.route,W)];if(Object.prototype.hasOwnProperty.call(J,"data")&&J.data!==V.data)if(J.nodeName==="#text")return[new A().setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,W).setValue(this.options._const.oldValue,J.data).setValue(this.options._const.newValue,V.data)];else return[new A().setValue(this.options._const.action,this.options._const.modifyComment).setValue(this.options._const.route,W).setValue(this.options._const.oldValue,J.data).setValue(this.options._const.newValue,V.data)];J=J,V=V,Z=J.attributes?Object.keys(J.attributes).sort():[],z=V.attributes?Object.keys(V.attributes).sort():[],P=Z.length;for($=0;$<P;$++)if(X=Z[$],K=z.indexOf(X),K===-1)Q.push(new A().setValue(this.options._const.action,this.options._const.removeAttribute).setValue(this.options._const.route,W).setValue(this.options._const.name,X).setValue(this.options._const.value,J.attributes[X]));else if(z.splice(K,1),J.attributes[X]!==V.attributes[X])Q.push(new A().setValue(this.options._const.action,this.options._const.modifyAttribute).setValue(this.options._const.route,W).setValue(this.options._const.name,X).setValue(this.options._const.oldValue,J.attributes[X]).setValue(this.options._const.newValue,V.attributes[X]));P=z.length;for($=0;$<P;$++)X=z[$],Q.push(new A().setValue(this.options._const.action,this.options._const.addAttribute).setValue(this.options._const.route,W).setValue(this.options._const.name,X).setValue(this.options._const.value,V.attributes[X]));return Q},H.prototype.findInnerDiff=function(J,V,W){var Q=J.childNodes?J.childNodes.slice():[],X=V.childNodes?V.childNodes.slice():[],Z=Math.max(Q.length,X.length),z=Math.abs(Q.length-X.length),P=[],K=0;if(!this.options.maxChildCount||Z<this.options.maxChildCount){var $=Boolean(J.subsets&&J.subsetsAge--),G=$?J.subsets:J.childNodes&&V.childNodes?d(J,V):[];if(G.length>0){if(P=this.attemptGroupRelocation(J,V,G,W,$),P.length>0)return P}}for(var M=0;M<Z;M+=1){var B=Q[M],U=X[M];if(z){if(B&&!U)if(B.nodeName==="#text")P.push(new A().setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,W.concat(K)).setValue(this.options._const.value,B.data)),K-=1;else P.push(new A().setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,W.concat(K)).setValue(this.options._const.element,w(B))),K-=1;else if(U&&!B)if(U.nodeName==="#text")P.push(new A().setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,W.concat(K)).setValue(this.options._const.value,U.data));else P.push(new A().setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,W.concat(K)).setValue(this.options._const.element,w(U)))}if(B&&U){if(!this.options.maxChildCount||Z<this.options.maxChildCount)P=P.concat(this.findNextDiff(B,U,W.concat(K)));else if(!b(B,U))if(Q.length>X.length){if(B.nodeName==="#text")P.push(new A().setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,W.concat(K)).setValue(this.options._const.value,B.data));else P.push(new A().setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.element,w(B)).setValue(this.options._const.route,W.concat(K)));Q.splice(M,1),M-=1,K-=1,z-=1}else if(Q.length<X.length)P=P.concat([new A().setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.element,w(U)).setValue(this.options._const.route,W.concat(K))]),Q.splice(M,0,w(U)),z-=1;else P=P.concat([new A().setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,w(B)).setValue(this.options._const.newValue,w(U)).setValue(this.options._const.route,W.concat(K))])}K+=1}return J.innerDone=!0,P},H.prototype.attemptGroupRelocation=function(J,V,W,Q,X){var Z=p(J,V,W),z=Z.gaps1,P=Z.gaps2,K=J.childNodes.slice(),$=V.childNodes.slice(),G=Math.min(z.length,P.length),M,B,U,Y,F,E=[];for(var R=0,O=0;R<G;O+=1,R+=1)if(X&&(z[R]===!0||P[R]===!0));else if(z[O]===!0)if(Y=K[O],Y.nodeName==="#text")if($[R].nodeName==="#text"){if(Y.data!==$[R].data){var S=O;while(K.length>S+1&&K[S+1].nodeName==="#text")if(S+=1,$[R].data===K[S].data){F=!0;break}if(!F)E.push(new A().setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,Q.concat(O)).setValue(this.options._const.oldValue,Y.data).setValue(this.options._const.newValue,$[R].data))}}else E.push(new A().setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,Q.concat(O)).setValue(this.options._const.value,Y.data)),z.splice(O,1),K.splice(O,1),G=Math.min(z.length,P.length),O-=1,R-=1;else if(P[R]===!0)E.push(new A().setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,w(Y)).setValue(this.options._const.newValue,w($[R])).setValue(this.options._const.route,Q.concat(O)));else E.push(new A().setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,Q.concat(O)).setValue(this.options._const.element,w(Y))),z.splice(O,1),K.splice(O,1),G=Math.min(z.length,P.length),O-=1,R-=1;else if(P[R]===!0)if(Y=$[R],Y.nodeName==="#text")E.push(new A().setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,Q.concat(O)).setValue(this.options._const.value,Y.data)),z.splice(O,0,!0),K.splice(O,0,{nodeName:"#text",data:Y.data}),G=Math.min(z.length,P.length);else E.push(new A().setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,Q.concat(O)).setValue(this.options._const.element,w(Y))),z.splice(O,0,!0),K.splice(O,0,w(Y)),G=Math.min(z.length,P.length);else if(z[O]!==P[R]){if(E.length>0)return E;if(U=W[z[O]],B=Math.min(U.newValue,K.length-U.length),B!==U.oldValue){M=!1;for(var k=0;k<U.length;k+=1)if(!g(K[B+k],K[U.oldValue+k],{},!1,!0))M=!0;if(M)return[new A().setValue(this.options._const.action,this.options._const.relocateGroup).setValue(this.options._const.groupLength,U.length).setValue(this.options._const.from,U.oldValue).setValue(this.options._const.to,B).setValue(this.options._const.route,Q)]}}return E},H.prototype.findValueDiff=function(J,V,W){var Q=[];if(J.selected!==V.selected)Q.push(new A().setValue(this.options._const.action,this.options._const.modifySelected).setValue(this.options._const.oldValue,J.selected).setValue(this.options._const.newValue,V.selected).setValue(this.options._const.route,W));if((J.value||V.value)&&J.value!==V.value&&J.nodeName!=="OPTION")Q.push(new A().setValue(this.options._const.action,this.options._const.modifyValue).setValue(this.options._const.oldValue,J.value||"").setValue(this.options._const.newValue,V.value||"").setValue(this.options._const.route,W));if(J.checked!==V.checked)Q.push(new A().setValue(this.options._const.action,this.options._const.modifyChecked).setValue(this.options._const.oldValue,J.checked).setValue(this.options._const.newValue,V.checked).setValue(this.options._const.route,W));return Q},H}(),H1={debug:!1,diffcap:10,maxDepth:!1,maxChildCount:50,valueDiffing:!0,textDiff:function(H,J,V,W){H.data=W;return},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null,compress:!1,_const:!1,document:typeof window!=="undefined"&&window.document?window.document:!1,components:[]},Q1=function(){function H(J){if(J===void 0)J={};if(Object.entries(H1).forEach(function(Q){var X=Q[0],Z=Q[1];if(!Object.prototype.hasOwnProperty.call(J,X))J[X]=Z}),!J._const){var V=["addAttribute","modifyAttribute","removeAttribute","modifyTextElement","relocateGroup","removeElement","addElement","removeTextElement","addTextElement","replaceElement","modifyValue","modifyChecked","modifySelected","modifyComment","action","route","oldValue","newValue","element","group","groupLength","from","to","name","value","data","attributes","nodeName","childNodes","checked","selected"],W={};if(J.compress)V.forEach(function(Q,X){return W[Q]=X});else V.forEach(function(Q){return W[Q]=Q});J._const=W}this.options=J}return H.prototype.apply=function(J,V){return m(J,V,this.options)},H.prototype.undo=function(J,V){return r(J,V,this.options)},H.prototype.diff=function(J,V){var W=new J1(J,V,this.options);return W.init()},H}(),W1=function(){function H(J){var V=this;if(J===void 0)J={};this.pad="\u2502   ",this.padding="",this.tick=1,this.messages=[];var W=function(X,Z){var z=X[Z];X[Z]=function(){var P=arguments,K=[];for(var $=0;$<arguments.length;$++)K[$]=P[$];V.fin(Z,Array.prototype.slice.call(K));var G=z.apply(X,K);return V.fout(Z,G),G}};for(var Q in J)if(typeof J[Q]==="function")W(J,Q);this.log("\u250C TRACELOG START")}return H.prototype.fin=function(J,V){this.padding+=this.pad,this.log("\u251C\u2500> entering ".concat(J),V)},H.prototype.fout=function(J,V){this.log("\u2502<\u2500\u2500\u2518 generated return value",V),this.padding=this.padding.substring(0,this.padding.length-this.pad.length)},H.prototype.format=function(J,V){var W=function(Q){var X="".concat(Q);while(X.length<4)X="0".concat(Q);return X};return"".concat(W(V),"> ").concat(this.padding).concat(J)},H.prototype.log=function(){var J=arguments,V=[];for(var W=0;W<arguments.length;W++)V[W]=J[W];var Q=function(Z){if(!Z)return"<falsey>";if(typeof Z==="string")return Z;if(q(Z,"HTMLElement"))return Z.outerHTML||"<empty>";if(Z instanceof Array)return"[".concat(Z.map(Q).join(","),"]");return Z.toString()||Z.valueOf()||"<unknown>"},X=V.map(Q).join(", ");this.messages.push(this.format(X,this.tick++))},H.prototype.toString=function(){var J="\xD7   ",V="\u2514\u2500\u2500\u2500";while(V.length<=this.padding.length+this.pad.length)V+=J;var W=this.padding;return this.padding="",V=this.format(V,this.tick),this.padding=W,"".concat(this.messages.join("\n"),"\n").concat(V)},H}();export{T as stringToObj,v as nodeToObj,W1 as TraceLogger,Q1 as DiffDOM};
